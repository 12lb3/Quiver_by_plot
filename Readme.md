[toc]

## 1. Introduction

To be finished.

### 1.1 Features/Why I wrote this

+ More flexibility than the built-in function `quiver`.

  The arrows are generated by `plot`/`patch`, which provides the possibility that everything can be adjusted. Here are some of the examples:

  + The length of head (fixed length, or a ratio to the arrow length, etc.)
  + Angles between two edges of head. 
  + Show/hide the head of arrows.

  + Show/hide the body of arrows. 
  + Other properties in `plot` or `patch`.
  + ...

+ Colorful arrows adopted to current colormap

+ Support creating vector time series

+ "Perfect" arrows

  

### 1.2 Functions included

+ `FUN_quiver_by_plotV2.m`

  ​	Plot single color arrows by `plot`

+ `FUN_quiver_by_plotV2_mmap.m`

  ​	This is same as `FUN_quiver_by_plotV2.m` but compatible with [`mmap`](https://www.eoas.ubc.ca/~rich/mapug.html)

+ `FUN_quiver_by_plotV2_cmap_patch.m`

  ​	Plot colorful arrows based on `patch`. The color of arrows depends on colormap.

+ `FUN_quiver_by_plotV2_cmap_patch_mmap.m`

  ​	This is same as `FUN_quiver_by_plotV2_cmap_patch.m` but compatible with [`mmap`](https://www.eoas.ubc.ca/~rich/mapug.html)

+ `FUN_quiver_by_plotV2_preset_cmap.m`

  ​	[not recommended!] This is similar to `FUN_quiver_by_plotV2_cmap_patch` but the color is defined based on a fixed colormap, which must be specified 



### Limitation

**To create a *perfect* arrow, the `xlim` and `ylim` must be defined explicitly and it should not be changed after calling this toolbox.**



## 2. Install

You need to add this to the searching path of your Matlab environment before using them. The `private` folder must be put in the same folder as `FUN_quiver_by_plotV2*.m`.  The subfolders (`private`, `doc`) should not be added to the searching path. It can be done by two ways:

#### If you have GUI access to Matlab : 

Click "Home tab> Set Path". It will open a dialog for setting the path. Then, click "Add Folder...", add the root path of this package (the folder contains functions `FUN_quiver_by_plotV2*.m`), then click "Save" near the bottom of the dialog.  

#### If you are in a command line environment:

+ Method 1 (recommended):

  ```
  addpath('/path/to/Quiver_by_plotV2/');
  savepath
  ```

+ Method 2: 
  Matlab will run `startup.m` during boot automatically if the file exists. Thus, you can add `addpath('/path/to/Quiver_by_plotV2/');` to the `startup.m` file and make sure that the `startup.m` is put in existing searching path. This provide more flexibility.



## 3. Examples

Data used in this demo is generated by the following codes

```matlab
x = -1:0.2:1;
y = -1:0.2:1;

[X,Y] = meshgrid(x,y);
X=X';
Y=Y';

theta = atan2d(Y,X);

r = sqrt( X.^2 + Y.^2);

u =  sind( theta ) .* r / 100;
v = -cosd( theta ) .* r / 100;

x = x*10 - 75;
y = y*10 + 35;
```

This is also available here: [Data_demo_1.mat](doc\Data_demo_1.mat).



### 3.1 Plot arrows without colormap (`FUN_quiver_by_plotV2.m`)

`FUN_quiver_by_plotV2`



```matlab
FUN_quiver_by_plotV2( x, y, u, v)
FUN_quiver_by_plotV2( x, y, u, v, vel_scale)
FUN_quiver_by_plotV2( x, y, u, v, vel_scale, ...)
```

#### INPUT:
​       x, y, u, v : input data
​       vel_scale [optional, default: 1 ]
​                  0: auto scale  
​                  1: No scale, the original u/v will be used
​                  otherwise: this scale will be applied to u and v.

#### Other parameters

| Parameter            | Default value | Notes                                                        |
| -------------------- | ------------- | ------------------------------------------------------------ |
| is_plot_head         | true          | show/hide head of arrows                                     |
| is_plot_body         | true          | show/hide body of arrows                                     |
| fill_head            | false         |                                                              |
| color                | 'k'           | color of arrows                                              |
| head_length          | 0             | length of arrow head<br />                                   |
| head_length_min      | 0             | minimal length of arrow head<br />                           |
| head_angle           | 15            | Angle between arrow head and arrow body<br />`2*head_angle` is the angle between the two wings of arrow heads |
| is_correct_angle     | false         | This is for vector time series and some special cases. <br /> |
| interval             | 1             | interval                                                     |
| interval_x           | interval      | interval for the first dim                                   |
| interval_y           | interval      | interval for the second dim                                  |
| is_plot_via_arrayfun | false         | use `arrayfun`<br />**false**: two handles will be returned (one for array body and one for arrow head)<br />**true**: two handles will be returned for each arrow (one for array body and one for arrow head) |
| [others in plot]     | ....          | Other parameters (e.g., 'linewidth') applicable to `plot` also works here. |

#### Output

​     h1: handle array for arrow body
​     h2: handle array for arrow head

​     uu [ 3 x N ]: x coordinate for arrow body, the 3 values in each col are [ x_origin; x_head; Nan]
​     vv [ 3 x N ]: y coordinate for arrow body, the 3 values in each col are [ y_origin; y_head; Nan]
​     hu [ 4 x N ]: x coordinate for arrow head, the 4 values in each col are [ x_head_wing1, x_head_center, x_head_wing2; Nan]
​     hv [ 4 x N ]: y coordinate for arrow head, the 4 values in each col are [ y_head_wing1, y_head_center, y_head_wing2; Nan]

​     you can re-plot the arrows by uu,vv hu, hv:

        ```matlab
             plot( uu(:), vv(:) ); % plot arrow body
             hold on
             plot( hu(:), hv(:) ); % plot arrow head
        ```



#### DEMO - arrows on a map

```matlab
figure
xlim([-88 -62]);
ylim([22 48]);

FUN_quiver_by_plotV2( x, y, u, v, 0 )

title('Example 3.1: FUN_quiver_by_plotV2','Interpreter','none');

FUN_easy_export_fig('Example_3.1.jpg','-m2');
```

<img src="doc/1.2/Example_1.2a.jpg" alt="Example_1.2a" style="zoom: 50%;" />



#### Demo - vector time series 



### 3.2 Plot colorful arrows

### 3.2.1 Example 2.1: A simple case

In this case, the color is defined by the length of arrows, which is usually the magnitude of velocities.

```matlab

% prepare data
x = 1:40;
y = 1:30;

[X,Y] = meshgrid(x,y);
X=X';
Y=Y';

u = sin( 2*pi/30 .* X );
v = cos( 2*pi/30 .* Y );

% plot
figure

arrow_scale = 0; % 0: the scale is determined by the script automatically.
FUN_quiver_by_plotV2_cmap_patch( x, y, u, v, arrow_scale );

grid on
box on
xlabel('x');
ylabel('y');
colorbar

title({'Example 1: a simple case', 'Color is defined by the magnitude of arrows'});


```

<img src="doc/Example_2.1.jpg" alt="Example_1" style="zoom:67%;" />

#### 3.2 Example 2.2: the color is defined by a given matrix

In this example, the arrow color is defined in parameter `zval`.

```matlab
figure

arrow_scale = 0; %auto

value_for_color = sqrt(X.^2+Y.^2);
FUN_quiver_by_plotV2_cmap_patch( x, y, u, v, arrow_scale, 'zval', value_for_color );

grid on
box on

xlabel('x');
ylabel('y');

colorbar

title({'Example 2.2: Color is defined by parameter "zval"'});
```

<img src="doc/Example_2.1.jpg" alt="Example_2.1" style="zoom:67%;" />



## 4. Acknowledgements



